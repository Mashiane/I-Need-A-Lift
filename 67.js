if(!navigator.cookieEnabled)NSB.MsgBox('Please turn cookies on.');(function(){var all=document.getElementsByTagName('*');for(var i=0;i<all.length;i++)if(typeof all[i].id!='undefined'&&typeof window[all[i].id]=='undefined')window[all[i].id]=all[i];})()
window.addEventListener('load',function(){frmMain.style.display='block';NSB.addProperties(hdrMain);NSB.addDisableProperty(hdrMain);if(typeof(hdrMain.onclick)=='function'){if(typeof(hdrMain_left)!='undefined')hdrMain_left.onclick=function(){hdrMain.onclick(hdrMain_left.getAttribute('nsbvalue'))};if(typeof(hdrMain_right)!='undefined')hdrMain_right.onclick=function(){hdrMain.onclick(hdrMain_right.getAttribute('nsbvalue'))}};NSB.List_jqm_init14('lstMain','One',false,'100%',false,false);lstMain.refresh=function(){if(typeof lstMain_ref!='undefined')setTimeout(NSB.refresh,100,lstMain_ref)};NSB.addProperties(lstMain);(function(){var d,i,s=''.split(',');for(i=0;i<s.length;i++){if(trim(s[i])!=''){d=document.getElementById('lstMain_'+i);(function(i){d.onclick=function(){ChangeForm(document.getElementById(s[i]))}})(i)}}})()
frmMain.style.display='none';},false);frmMain.onsubmit=function(event){window.event.stopPropagation();window.event.preventDefault()};NSB.addProperties(frmMain);frmMain.onshow=function(){savethefunction_rvar="";ListViewClear(lstMain);lstMain.addItem("<br/>Register","signup.png");lstMain.addItem("<br/>Sign In","login.png");return savethefunction_rvar;}
lstMain.onclick=function(i){savethefunction_rvar="";if(TypeName(i)=="object"){return savethefunction_rvar;}
switch(True){case((i)==0):ChangeForm(frmTC);break;case((i)==1):ChangeForm(frmLogin);break;case((i)==2):ChangeForm(frmLiftSearch);break;case((i)==3):ChangeForm(frmLiftClubs);break;case((i)==4):NSB.MsgBox(PanicButton,"You are about to send a panic alert to your next of kin and the police, are you sure?",4+32,"Confirm Panic Button");}
return savethefunction_rvar;}
function PanicButton(result){if(result==7){return;}
NSB.MsgBox("Panic Alert has been sent to your next of kin and the police!");}
var usrLoginAttempts,usrKey,usrFile;var usrFound,usrProfile,usrXML;var usrURL,strPlaces,usrFrom;var usrCode,usrNew,usrSent;var tripXML,liftFile,usrOffer;var usrRequest,vehNew,vehExists;var vehFile,vehXML,usrVehicle;var strVehicle,strVehicleDetails,vehiclefile,vehiclefiles,vehicles;var offerfile,offerfiles,offers,bookingfile;var bookingfiles,bookings,usrBooking;var requestfile,requestfiles,requests;function RequestTable(usrRequest){savethefunction_rvar="";var stable,sFromTo,sdate;sFromTo=usrRequest.origin+" to "+usrRequest.destination;sdate=usrRequest.date;sdate=FormatDateTime(CDate(sdate),1);stable="<table style='border:1px solid black;'>";stable=stable+"<tr><td>"+NormalizeText("On:")+"</td><td>"+NormalizeText(sdate+" at "+usrRequest.time)+"</td></tr>";stable=stable+"<tr><td>"+NormalizeText("Passengers:")+"</td><td>"+NormalizeText(usrRequest.passengers+" at R"+MakeMoney(usrRequest.fee)+" Per Person")+"</td></tr>";stable=stable+"<tr><td>"+NormalizeText("Requested By:")+"</td><td>"+NormalizeText(usrRequest.offerby)+"</td></tr>";if(usrRequest.status=="Closed"){stable=stable+"<tr><td>"+NormalizeText("Status:")+"</td><td>"+RedBold(NormalizeText(usrRequest.status))+"</td></tr>";}else{stable=stable+"<tr><td>"+NormalizeText("Status:")+"</td><td>"+GreenBold(NormalizeText(usrRequest.status))+"</td></tr>";}
stable=stable+"</table>";return stable;return savethefunction_rvar;}
function OfferTable(usrBooking){savethefunction_rvar="";var stable,sFromTo,sdate;sdate=usrBooking.date;sdate=FormatDateTime(CDate(sdate),1);stable="<table style='border:1px solid black;'>";stable=stable+"<tr><td>"+NormalizeText("On:")+"</td><td>"+NormalizeText(sdate+" at "+usrBooking.time)+"</td></tr>";stable=stable+"<tr><td>"+NormalizeText("Passengers:")+"</td><td>"+NormalizeText(usrBooking.taken+"/"+usrBooking.passengers+" at R"+MakeMoney(usrBooking.fee)+" Per Person")+"</td></tr>";stable=stable+"<tr><td>"+NormalizeText("Car Registration:")+"</td><td>"+NormalizeText(usrBooking.registration)+"</td></tr>";stable=stable+"<tr><td>"+NormalizeText("Offered By:")+"</td><td>"+NormalizeText(usrBooking.offerby)+"</td></tr>";if(usrBooking.status=="Closed"){stable=stable+"<tr><td>"+NormalizeText("Status:")+"</td><td>"+RedBold(NormalizeText(usrBooking.status))+"</td></tr>";}else{stable=stable+"<tr><td>"+NormalizeText("Status:")+"</td><td>"+GreenBold(NormalizeText(usrBooking.status))+"</td></tr>";}
stable=stable+"</table>";return stable;return savethefunction_rvar;}
function GetUserVehicles(){savethefunction_rvar="";vehicles=[];req=Ajax("ajaxVehicles.php");if(req.status==200){vehiclefiles=Split(req.responseText,'\n');for(i=0;i<=vehiclefiles.length-1;i++){vehiclefile=Trim(vehiclefiles[i]);if(Len(vehiclefile)>0){req=Ajax("ajaxVehicles.php?file="+encodeURIComponent(vehiclefile));if(req.status==200){usrVehicle=$.xml2json(req.responseText);if(usrVehicle.mobile==usrProfile.mobile){vehicles.push(usrVehicle);}}}}
vehicles=sortJSON(vehicles,"registration");}
return savethefunction_rvar;}
function Main(){NSB.WaitCursor(True);NSB.MsgBoxStyle="";usrLoginAttempts=0;usrFound=False;ListViewClear(lstMain);ListViewClear(lstLifts);ClearUser();ClearVehicle();ClearOffer();ListViewClear(lstAfterLogin);ClearNOK();ListViewClear(lstChooser);ClearRequest();ListViewClear(lstRequests);ListViewClear(lstOffers);ListViewClear(lstVehicles);ListViewClear(lstOpenOffer);ListViewClear(lstMyBookings);ListViewClear(lstMyOffers);txtTC.Height=frmTC.Height-50;txtSignUp.Width=frmSignUp.Width-20;vh.Width=frmAddVehicle.Width-20;ResizeOffer();ResizeLogin();ResizeRegCode();txtNextOfKin.Width=frmNextOfKin.Width-20;ResizeRequest();ResizeRequests();ResizeOffers();ResizeVehicles();ResizeMyBookings();ResizeMyOffers();ReadPlaces();NSB.WaitCursor(False);}
function SaveUser(){savethefunction_rvar="";NSB.WaitCursor(True);usrXML=json2xml(usrProfile,"user");usrXML="<?xml version='1.0' encoding='utf-8'?>"+usrXML;req=Ajax("ajaxSaveProfile.php","POST",usrXML);if(req.status==200){NSB.WaitCursor(False);return True;}else{NSB.WaitCursor(False);return False;}
return savethefunction_rvar;}
function SaveLiftRequest(lift){savethefunction_rvar="";NSB.WaitCursor(True);tripXML=json2xml(lift,"lift");tripXML="<?xml version='1.0' encoding='utf-8'?>"+tripXML;req=Ajax("ajaxSaveRequest.php","POST",tripXML);if(req.status==200){NSB.WaitCursor(False);return True;}else{NSB.WaitCursor(False);return False;}
return savethefunction_rvar;}
function SaveLiftOffer(lift){savethefunction_rvar="";NSB.WaitCursor(True);tripXML=json2xml(lift,"lift");tripXML="<?xml version='1.0' encoding='utf-8'?>"+tripXML;req=Ajax("ajaxSaveOffer.php","POST",tripXML);if(req.status==200){NSB.WaitCursor(False);return True;}else{NSB.WaitCursor(False);return False;}
return savethefunction_rvar;}
function AddVehicle(vehicle){savethefunction_rvar="";NSB.WaitCursor(True);vehXML=json2xml(vehicle,"vehicle");vehXML="<?xml version='1.0' encoding='utf-8'?>"+vehXML;req=Ajax("ajaxSaveVehicle.php","POST",vehXML);if(req.status==200){NSB.WaitCursor(False);return True;}else{NSB.WaitCursor(False);return False;}
return savethefunction_rvar;}
function ReadOffer(id){savethefunction_rvar="";NSB.WaitCursor(True);liftFile="offers/"+id+".xml?&"+SysInfo(10);req=ReadFile(liftFile);NSB.WaitCursor(False);if(req.status==200){usrOffer=$.xml2json(req.responseText);}else{usrOffer=null;}
return savethefunction_rvar;}
function ReadUser(user){savethefunction_rvar="";NSB.WaitCursor(True);usrFile="users/"+user+".xml?&"+SysInfo(10);req=ReadFile(usrFile);if(req.status==200){usrProfile=$.xml2json(req.responseText);NSB.WaitCursor(False);}else{usrProfile=null;NSB.WaitCursor(False);}
return savethefunction_rvar;}
function ProfileExists(user){savethefunction_rvar="";NSB.WaitCursor(True);usrFile="users/"+user+".xml?&"+SysInfo(10);req=ReadFile(usrFile);NSB.WaitCursor(False);if(req.status==200){return True;}else{return False;}
return savethefunction_rvar;}
function VehicleExists(registration){savethefunction_rvar="";NSB.WaitCursor(True);vehFile="vehicles/"+registration+".xml?&"+SysInfo(10);req=ReadFile(vehFile);NSB.WaitCursor(False);if(req.status==200){return True;}else{return False;}
return savethefunction_rvar;}
function OfferExists(id){savethefunction_rvar="";NSB.WaitCursor(True);liftFile="offers/"+id+".xml?&"+SysInfo(10);req=ReadFile(liftFile);NSB.WaitCursor(False);if(req.status==200){return True;}else{return False;}
return savethefunction_rvar;}
function RequestExists(id){savethefunction_rvar="";NSB.WaitCursor(True);liftFile="requests/"+id+".xml?&"+SysInfo(10);req=ReadFile(liftFile);NSB.WaitCursor(False);if(req.status==200){return True;}else{return False;}
return savethefunction_rvar;}
function SendSMS(country,mobile,message){savethefunction_rvar="";NSB.WaitCursor(True);var winSMS,prefix,strBuffer;var winSmsUser;winSmsUser="anele@mbangas.com";var winSmsPwd;winSmsPwd="usioloeso123";prefix=Left(mobile,1);if(prefix=="0"){mobile=Mid(mobile,2);}
mobile=country+mobile;message=encodeURI(message);winSMS="http://www.winsms.co.za/api/batchmessage.asp?user="+winSmsUser+"&password="+winSmsPwd+"&message="+message+"&Numbers="+mobile+";";req=Ajax(winSMS);strBuffer=req.responseText;console.log(req.status);console.log(strBuffer);NSB.WaitCursor(False);if(Len(strBuffer)==0){return False;}else{if((InStr(strBuffer,"NOCREDITS")==0)&&(InStr(strBuffer,"FAIL")==0)&&(InStr(strBuffer,"INVALID")==0)){return True;}else{return False;}}
return savethefunction_rvar;}
function ReadPlaces(){savethefunction_rvar="";usrFile="places.txt?&"+SysInfo(10);req=ReadFile(usrFile);if(req.status==200||req.status==0){strPlaces=req.responseText;}else{strPlaces="";}
return savethefunction_rvar;}
window.addEventListener('load',function(){frmTC.style.display='block';NSB.addProperties(hdTC);NSB.addDisableProperty(hdTC);hdTC_left.onclick=function(){ChangeForm(frmMain)};if(typeof(hdTC.onclick)=='function'){if(typeof(hdTC_left)!='undefined')hdTC_left.onclick=function(){hdTC.onclick(hdTC_left.getAttribute('nsbvalue'))};if(typeof(hdTC_right)!='undefined')hdTC_right.onclick=function(){hdTC.onclick(hdTC_right.getAttribute('nsbvalue'))}};txtTC.ontouchmove=function(e){e.stopPropagation()};NSB.addProperties(txtTC);frmTC.style.display='none';},false);frmTC.onsubmit=function(event){window.event.stopPropagation();window.event.preventDefault()};NSB.addProperties(frmTC);frmTC.onshow=function(){savethefunction_rvar="";txtTC.Height=frmTC.Height-50;return savethefunction_rvar;}
hdTC.onclick=function(choice){savethefunction_rvar="";if(TypeName(choice)=="object"){return savethefunction_rvar;}
switch(True){case((choice)=="Next"):usrFrom="frmTC";NSB.MsgBox(AcceptTC,"By continuing, it means you are in agreement with the Terms and Conditions of I-Need-A-Lift. Continue?",4+32,"Confirm T&Cs");break;case((choice)=="Home"):ChangeForm(frmMain);}
return savethefunction_rvar;}
function AcceptTC(result){if(result==7){return;}
ChangeForm(frmSignUp);}
window.addEventListener('load',function(){frmLiftSearch.style.display='block';NSB.addProperties(hdLiftSearch);NSB.addDisableProperty(hdLiftSearch);if(typeof(hdLiftSearch.onclick)=='function'){if(typeof(hdLiftSearch_left)!='undefined')hdLiftSearch_left.onclick=function(){hdLiftSearch.onclick(hdLiftSearch_left.getAttribute('nsbvalue'))};if(typeof(hdLiftSearch_right)!='undefined')hdLiftSearch_right.onclick=function(){hdLiftSearch.onclick(hdLiftSearch_right.getAttribute('nsbvalue'))}};frmLiftSearch.style.display='none';},false);frmLiftSearch.onsubmit=function(event){window.event.stopPropagation();window.event.preventDefault()};NSB.addProperties(frmLiftSearch);hdLiftSearch.onclick=function(choice){savethefunction_rvar="";if(TypeName(choice)=="object"){return savethefunction_rvar;}
switch(True){case((choice)=="Search"):break;case((choice)=="Back"):ChangeForm(frmLifts);}
return savethefunction_rvar;}
window.addEventListener('load',function(){frmSignUp.style.display='block';NSB.addProperties(hdSignUp);NSB.addDisableProperty(hdSignUp);hdSignUp_left.onclick=function(){ChangeForm(frmMain)};if(typeof(hdSignUp.onclick)=='function'){if(typeof(hdSignUp_left)!='undefined')hdSignUp_left.onclick=function(){hdSignUp.onclick(hdSignUp_left.getAttribute('nsbvalue'))};if(typeof(hdSignUp_right)!='undefined')hdSignUp_right.onclick=function(){hdSignUp.onclick(hdSignUp_right.getAttribute('nsbvalue'))}};NSB.MultiInput_init('txtSignUp');NSB.addProperties(txtSignUp);frmSignUp.style.display='none';},false);frmSignUp.onsubmit=function(event){window.event.stopPropagation();window.event.preventDefault()};NSB.addProperties(frmSignUp);frmSignUp.onshow=function(){savethefunction_rvar="";txtSignUp.Width=frmSignUp.Width-20;switch(True){case((usrFrom)=="frmTC"):$("#hdSignUp h1").text("Register");usrNew=True;usrProfile=[];usrProfile.first="Guest";ClearUser();break;case((usrFrom)=="frmAfterLogin"):$("#hdSignUp h1").text(usrProfile.fullname);usrNew=False;SetUser();break;case((usrFrom)=="frmChooser"):$("#hdSignUp h1").text(usrProfile.fullname);usrNew=False;SetUser();}
return savethefunction_rvar;}
function ClearUser(){savethefunction_rvar="";txtSignUp.setValue(1,"");txtSignUp.setValue(2,"");txtSignUp.setValue(3,"");txtSignUp.setValue(4,"");txtSignUp.setValue(5,"");txtSignUp.setValue(6,"");return savethefunction_rvar;}
function SetUser(){savethefunction_rvar="";txtSignUp.setValue(1,usrProfile.first);txtSignUp.setValue(2,usrProfile.last);txtSignUp.setValue(3,usrProfile.mobile);txtSignUp.setValue(4,usrProfile.mobile);txtSignUp.setValue(5,usrProfile.password);txtSignUp.setValue(6,usrProfile.password);return savethefunction_rvar;}
function RegisterUser(){savethefunction_rvar="";var cmobile,cpassword,uSaved,uExist,ucode;if(usrNew==True){ucode=passwordcreate(8);ucode=UCase(ucode);usrProfile.blocked="y";usrProfile.nokblocked="y";usrProfile.lastlogin=FormatDateTime(CDATE(new Date()),"yyyy-mm-dd");usrProfile.nokfirst="";usrProfile.noklast="";usrProfile.nokmobile="";}else{ucode=usrProfile.code;}
usrProfile.code=ucode;usrProfile.first=txtSignUp.getValue(1);usrProfile.last=txtSignUp.getValue(2);usrProfile.mobile=txtSignUp.getValue(3);cmobile=txtSignUp.getValue(4);usrProfile.password=txtSignUp.getValue(5);cpassword=txtSignUp.getValue(6);usrProfile.fullname=usrProfile.first+" "+usrProfile.last;if(IsBlank(usrProfile.first,"First Name",usrProfile.first)==True){return savethefunction_rvar;}
if(IsBlank(usrProfile.last,"Last Name",usrProfile.first)==True){return savethefunction_rvar;}
if(IsBlank(usrProfile.mobile,"Cellphone No",usrProfile.first)==True){return savethefunction_rvar;}
if(IsBlank(cmobile,"Confirm Cellphone No",usrProfile.first)==True){return savethefunction_rvar;}
if(IsSame(usrProfile.mobile,cmobile,"Cellphone No","Confirm Cellphone No",usrProfile.first)==False){return savethefunction_rvar;}
if(IsBlank(usrProfile.password,"Password",usrProfile.first)==True){return savethefunction_rvar;}
if(IsBlank(cpassword,"Confirm Password",usrProfile.first)==True){return savethefunction_rvar;}
if(IsSame(usrProfile.password,cpassword,"Password","Confirm Password",usrProfile.first)==False){return savethefunction_rvar;}
if(usrNew==True){uExist=ProfileExists(usrProfile.mobile);if(uExist==True){NSB.MsgBox("A user with the specified profile already exists "+usrProfile.first+"!");return savethefunction_rvar;}}
SaveUser();uExist=ProfileExists(usrProfile.mobile);if(uExist==True){localStorage.setItem("user",usrProfile.mobile);if(usrNew==True){ResendSecretCode();ChangeForm(frmRegCode);}else{ChangeForm(frmChooser);}}else{NSB.MsgBox("The user profile could not be saved, please try again "+usrProfile.first+"!");return savethefunction_rvar;}
return savethefunction_rvar;}
hdSignUp.onclick=function(choice){savethefunction_rvar="";if(TypeName(choice)=="object"){return savethefunction_rvar;}
switch(True){case((choice)=="Apply"):RegisterUser();break;case((choice)=="Back"):ChangeFormByName(usrFrom);}
return savethefunction_rvar;}
window.addEventListener('load',function(){frmLiftClubs.style.display='block';NSB.addProperties(hdLiftClub);NSB.addDisableProperty(hdLiftClub);hdLiftClub_left.onclick=function(){ChangeForm(frmAfterLogin)};if(typeof(hdLiftClub.onclick)=='function'){if(typeof(hdLiftClub_left)!='undefined')hdLiftClub_left.onclick=function(){hdLiftClub.onclick(hdLiftClub_left.getAttribute('nsbvalue'))};if(typeof(hdLiftClub_right)!='undefined')hdLiftClub_right.onclick=function(){hdLiftClub.onclick(hdLiftClub_right.getAttribute('nsbvalue'))}};frmLiftClubs.style.display='none';},false);frmLiftClubs.onsubmit=function(event){window.event.stopPropagation();window.event.preventDefault()};NSB.addProperties(frmLiftClubs);window.addEventListener('load',function(){frmLifts.style.display='block';NSB.addProperties(hdLifts);NSB.addDisableProperty(hdLifts);hdLifts_left.onclick=function(){ChangeForm(frmAfterLogin)};if(typeof(hdLifts.onclick)=='function'){if(typeof(hdLifts_left)!='undefined')hdLifts_left.onclick=function(){hdLifts.onclick(hdLifts_left.getAttribute('nsbvalue'))};if(typeof(hdLifts_right)!='undefined')hdLifts_right.onclick=function(){hdLifts.onclick(hdLifts_right.getAttribute('nsbvalue'))}};NSB.List_jqm_init14('lstLifts','One',false,'100%',false,false);lstLifts.refresh=function(){if(typeof lstLifts_ref!='undefined')setTimeout(NSB.refresh,100,lstLifts_ref)};NSB.addProperties(lstLifts);(function(){var d,i,s=''.split(',');for(i=0;i<s.length;i++){if(trim(s[i])!=''){d=document.getElementById('lstLifts_'+i);(function(i){d.onclick=function(){ChangeForm(document.getElementById(s[i]))}})(i)}}})()
frmLifts.style.display='none';},false);frmLifts.onsubmit=function(event){window.event.stopPropagation();window.event.preventDefault()};NSB.addProperties(frmLifts);lstLifts.onclick=function(i){savethefunction_rvar="";if(TypeName(i)=="object"){return savethefunction_rvar;}
switch(True){case((i)==0):GetUserVehicles();if((vehicles.length-1)==-1){NSB.MsgBox("Only users with registered vehicles can offer lifts. Access My Profile and register a vehicle first "+usrProfile.first+"!");return savethefunction_rvar;}else{ChangeForm(frmOffer);}
break;case((i)==1):ChangeForm(frmRequest);break;case((i)==2):ChangeForm(frmOffers);break;case((i)==3):ChangeForm(frmRequests);}
return savethefunction_rvar;}
frmLifts.onshow=function(){savethefunction_rvar="";ListViewClear(lstLifts);lstLifts.addItem("<br/>Offer a Lift","offer.png");lstLifts.addItem("<br/>Request a Lift","book.png");lstLifts.addItem("<br/>Available Offers","lifts.png");lstLifts.addItem("<br/>Available Requests","requests80.png");return savethefunction_rvar;}
window.addEventListener('load',function(){frmAddVehicle.style.display='block';NSB.addProperties(hdVehicle);NSB.addDisableProperty(hdVehicle);hdVehicle_left.onclick=function(){ChangeForm(frmVehicles)};if(typeof(hdVehicle.onclick)=='function'){if(typeof(hdVehicle_left)!='undefined')hdVehicle_left.onclick=function(){hdVehicle.onclick(hdVehicle_left.getAttribute('nsbvalue'))};if(typeof(hdVehicle_right)!='undefined')hdVehicle_right.onclick=function(){hdVehicle.onclick(hdVehicle_right.getAttribute('nsbvalue'))}};NSB.MultiInput_init('vh');NSB.addProperties(vh);frmAddVehicle.style.display='none';},false);frmAddVehicle.onsubmit=function(event){window.event.stopPropagation();window.event.preventDefault()};NSB.addProperties(frmAddVehicle);hdVehicle.onclick=function(choice){savethefunction_rvar="";if(TypeName(choice)=="object"){return savethefunction_rvar;}
switch(True){case((choice)=="Apply"):SaveVehicle();break;case((choice)=="Back"):ChangeForm(frmVehicles);}
return savethefunction_rvar;}
frmAddVehicle.onshow=function(){savethefunction_rvar="";switch(True){case((vehNew)==True):ClearVehicle();$("#hdVehicle h1").text("Add Vehicle");break;case((vehNew)==False):SetVehicle();$("#hdVehicle h1").text("Update Vehicle");}
vh.Width=frmAddVehicle.Width-20;return savethefunction_rvar;}
function ClearVehicle(){savethefunction_rvar="";vh.setValue(1,"");vh.setValue(2,"");vh.setValue(3,"");vh.setValue(4,"");vh.setValue(5,"");return savethefunction_rvar;}
function SetVehicle(){savethefunction_rvar="";vh.setValue(1,usrVehicle.make);vh.setValue(2,usrVehicle.model);vh.setValue(3,usrVehicle.color);vh.setValue(4,usrVehicle.registration);vh.setValue(5,usrVehicle.passengers);return savethefunction_rvar;}
function SaveVehicle(){savethefunction_rvar="";var vehicle;vehicle=[];var oSaved;oSaved=False;vehicle.make=vh.getValue(1);vehicle.model=vh.getValue(2);vehicle.color=vh.getValue(3);vehicle.registration=vh.getValue(4);vehicle.passengers=vh.getValue(5);vehicle.make=UCase(vehicle.make);vehicle.model=UCase(vehicle.model);vehicle.registration=UCase(vehicle.registration);vehicle.passengers=_jsCint(vehicle.passengers);vehicle.mobile=usrProfile.mobile;vehicle.belongsto=usrProfile.fullname;if(IsBlank(vehicle.make,"Vehicle Make",usrProfile.first)==True){return savethefunction_rvar;}
if(IsBlank(vehicle.model,"Vehicle Model",usrProfile.first)==True){return savethefunction_rvar;}
if(IsBlank(vehicle.color,"Vehicle Color",usrProfile.first)==True){return savethefunction_rvar;}
if(IsBlank(vehicle.registration,"Vehicle Registration",usrProfile.first)==True){return savethefunction_rvar;}
if(IsBlank(vehicle.passengers,"Vehicle Passengers",usrProfile.first)==True){return savethefunction_rvar;}
if(vehNew==True){vehExists=VehicleExists(vehicle.registration);if(vehExists==True){NSB.MsgBox("A vehicle with the specified Registration Number already exists "+usrProfile.first+"!");return savethefunction_rvar;}}
AddVehicle(vehicle);vehExists=VehicleExists(vehicle.registration);if(vehExists==True){NSB.MsgBox(ShowVehicles,"Your vehicle has been added successfully to the server "+usrProfile.first+"!",0+64,"Vehicle Updated");}else{NSB.MsgBox("Your vehicle has not been added successfully to the server "+usrProfile.first+"!");}}
function ShowVehicles(result){if(result==1){ChangeForm(frmVehicles);}}
window.addEventListener('load',function(){frmOffer.style.display='block';NSB.addProperties(hdOffer);NSB.addDisableProperty(hdOffer);hdOffer_left.onclick=function(){ChangeForm(frmMain)};if(typeof(hdOffer.onclick)=='function'){if(typeof(hdOffer_left)!='undefined')hdOffer_left.onclick=function(){hdOffer.onclick(hdOffer_left.getAttribute('nsbvalue'))};if(typeof(hdOffer_right)!='undefined')hdOffer_right.onclick=function(){hdOffer.onclick(hdOffer_right.getAttribute('nsbvalue'))}};NSB.MultiInput_init('liftoffer');NSB.addProperties(liftoffer);NSB.MultiInput_init('liftoffer1');NSB.addProperties(liftoffer1);txtNotes.ontouchmove=function(e){e.stopPropagation()};NSB.addProperties(txtNotes);delete cboOfferFrom.childNodes[0];NSB.ComboBox_init('cboOfferFrom');NSB.addProperties(cboOfferFrom);delete cboOfferTo.childNodes[0];NSB.ComboBox_init('cboOfferTo');NSB.addProperties(cboOfferTo);delete cboOfferVehicle.childNodes[0];NSB.ComboBox_init('cboOfferVehicle');NSB.addProperties(cboOfferVehicle);frmOffer.style.display='none';},false);frmOffer.onsubmit=function(event){window.event.stopPropagation();window.event.preventDefault()};NSB.addProperties(frmOffer);function SaveOffer(){savethefunction_rvar="";var lift;lift=[];var oSaved;oSaved=False;lift.origin=cboOfferFrom.selectedItem();lift.destination=cboOfferTo.selectedItem();lift.date=liftoffer.getValue(3);lift.time=liftoffer.getValue(4);lift.passengers=liftoffer1.getValue(1);lift.registration=cboOfferVehicle.selectedItem();lift.fee=liftoffer1.getValue(3);if(Len(lift.fee)==0){lift.fee="0.00";}
lift.status="Open";lift.offermobile=usrProfile.mobile;lift.offerby=usrProfile.fullname;lift.notes=txtNotes.text;lift.taken="0";lift.acceptedby="";if(IsBlank(lift.origin,"Place From",usrProfile.first)==True){return savethefunction_rvar;}
if(IsEqual(lift.origin,"---Select From---","Place From",usrProfile.first)==True){return savethefunction_rvar;}
if(IsBlank(lift.destination,"Place To",usrProfile.first)==True){return savethefunction_rvar;}
if(IsEqual(lift.destination,"---Select To---","Place To",usrProfile.first)==True){return savethefunction_rvar;}
if(IsSame1(lift.origin,lift.destination,"Place From","Place To",usrProfile.first)==True){return savethefunction_rvar;}
if(IsBlank(lift.date,"Trip Date",usrProfile.first)==True){return savethefunction_rvar;}
if(IsBlank(lift.time,"Trip Time",usrProfile.first)==True){return savethefunction_rvar;}
if(IsBlank(lift.passengers,"Passengers",usrProfile.first)==True){return savethefunction_rvar;}
if(IsBlank(lift.registration,"Car Registration",usrProfile.first)==True){return savethefunction_rvar;}
if(IsEqual(lift.registration,"---Select Vehicle---","Car Registration",usrProfile.first)==True){return savethefunction_rvar;}
if(IsBlank(lift.fee,"Fee Per Person",usrProfile.first)==True){return savethefunction_rvar;}
lift.registration=UCase(lift.registration);lift.time=UCase(lift.time);lift.id=SysInfo(10);SaveLiftOffer(lift);oSaved=OfferExists(lift.id);if(oSaved==True){NSB.MsgBox(ShowLifts,"Your lift offer has been successfully saved, and has been listed as available "+usrProfile.first+"!");}else{NSB.MsgBox("Your lift offer has not been successfully saved, please try again "+usrProfile.first+"!");}
return savethefunction_rvar;}
function ClearOffer(){savethefunction_rvar="";liftoffer.setValue(1,"");liftoffer.setValue(2,"");liftoffer.setValue(3,"");liftoffer.setValue(4,"");liftoffer1.setValue(1,"");liftoffer1.setValue(2,"");liftoffer1.setValue(3,"");txtNotes.text="";cboOfferFrom.clear();cboOfferTo.clear();cboOfferVehicle.clear();return savethefunction_rvar;}
function ResizeOffer(){savethefunction_rvar="";liftoffer.Width=frmOffer.Width-20;liftoffer1.Width=frmOffer.Width-20;txtNotes.Width=frmOffer.Width-20;cboOfferFrom.Left=(liftoffer.Width/2)+10;cboOfferFrom.Width=(liftoffer.Width/2)-5;cboOfferTo.Left=(liftoffer.Width/2)+10;cboOfferTo.Width=(liftoffer.Width/2)-5;cboOfferVehicle.Left=(liftoffer.Width/2)+10;cboOfferVehicle.Width=(liftoffer.Width/2)-5;return savethefunction_rvar;}
function OfferCombos(){savethefunction_rvar="";cboOfferFrom.addItem("---Select From---","---Select From---");cboOfferTo.addItem("---Select To---","---Select To---");var p;p=Split(strPlaces,";");var i,pr;for(i=0;i<=p.length-1;i++){pr=p[i];cboOfferFrom.addItem(pr,pr);cboOfferTo.addItem(pr,pr);}
cboOfferFrom.setValue("---Select From---");cboOfferTo.setValue("---Select To---");GetUserVehicles();cboOfferVehicle.addItem("---Select Vehicle---","---Select Vehicle---");for(i=0;i<=vehicles.length-1;i++){usrVehicle=vehicles[i];cboOfferVehicle.addItem(usrVehicle.registration,usrVehicle.registration);strVehicleDetails=JSON.stringify(usrVehicle);SaveSetting(usrVehicle.registration,strVehicleDetails);}
return savethefunction_rvar;}
frmOffer.onshow=function(){savethefunction_rvar="";NSB.WaitCursor(True);ResizeOffer();ClearOffer();OfferCombos();NSB.WaitCursor(False);return savethefunction_rvar;}
hdOffer.onclick=function(choice){savethefunction_rvar="";if(TypeName(choice)=="object"){return savethefunction_rvar;}
switch(True){case((choice)=="Apply"):SaveOffer();break;case((choice)=="Back"):ChangeForm(frmLifts);}
return savethefunction_rvar;}
window.addEventListener('load',function(){frmBook.style.display='block';NSB.addProperties(hdBook);NSB.addDisableProperty(hdBook);hdBook_left.onclick=function(){ChangeForm(frmMain)};if(typeof(hdBook.onclick)=='function'){if(typeof(hdBook_left)!='undefined')hdBook_left.onclick=function(){hdBook.onclick(hdBook_left.getAttribute('nsbvalue'))};if(typeof(hdBook_right)!='undefined')hdBook_right.onclick=function(){hdBook.onclick(hdBook_right.getAttribute('nsbvalue'))}};NSB.MultiInput_init('liftbook');NSB.addProperties(liftbook);txtBookNotes.ontouchmove=function(e){e.stopPropagation()};NSB.addProperties(txtBookNotes);frmBook.style.display='none';},false);frmBook.onsubmit=function(event){window.event.stopPropagation();window.event.preventDefault()};NSB.addProperties(frmBook);frmBook.onshow=function(){savethefunction_rvar="";liftbook.Width=frmBook.Width-20;txtBookNotes.Width=frmBook.Width-20;return savethefunction_rvar;}
hdBook.onclick=function(choice){savethefunction_rvar="";if(TypeName(choice)=="object"){return savethefunction_rvar;}
switch(True){case((choice)=="Apply"):ChangeForm(frmMyStuff);break;case((choice)=="Back"):ChangeForm(frmMyStuff);}
return savethefunction_rvar;}
window.addEventListener('load',function(){frmAfterLogin.style.display='block';NSB.addProperties(hdrAfterLogin);NSB.addDisableProperty(hdrAfterLogin);hdrAfterLogin_left.onclick=function(){ChangeForm(frmLogin)};if(typeof(hdrAfterLogin.onclick)=='function'){if(typeof(hdrAfterLogin_left)!='undefined')hdrAfterLogin_left.onclick=function(){hdrAfterLogin.onclick(hdrAfterLogin_left.getAttribute('nsbvalue'))};if(typeof(hdrAfterLogin_right)!='undefined')hdrAfterLogin_right.onclick=function(){hdrAfterLogin.onclick(hdrAfterLogin_right.getAttribute('nsbvalue'))}};NSB.List_jqm_init14('lstAfterLogin','One',false,'100%',false,false);lstAfterLogin.refresh=function(){if(typeof lstAfterLogin_ref!='undefined')setTimeout(NSB.refresh,100,lstAfterLogin_ref)};NSB.addProperties(lstAfterLogin);(function(){var d,i,s=''.split(',');for(i=0;i<s.length;i++){if(trim(s[i])!=''){d=document.getElementById('lstAfterLogin_'+i);(function(i){d.onclick=function(){ChangeForm(document.getElementById(s[i]))}})(i)}}})()
frmAfterLogin.style.display='none';},false);frmAfterLogin.onsubmit=function(event){window.event.stopPropagation();window.event.preventDefault()};NSB.addProperties(frmAfterLogin);frmAfterLogin.onshow=function(){savethefunction_rvar="";NSB.WaitCursor(True);$("#hdrAfterLogin h1").text(usrProfile.fullname);ListViewClear(lstAfterLogin);lstAfterLogin.addItem("<br/>Once Off Lifts","lift.png");lstAfterLogin.addItem("<br/>Lift Clubs","liftclub.png");lstAfterLogin.addItem("<br/>My Profile","profile80.png");ReadPlaces();OfferCombos();RequestCombos();NSB.WaitCursor(False);return savethefunction_rvar;}
lstAfterLogin.onclick=function(i){savethefunction_rvar="";if(TypeName(i)=="object"){return savethefunction_rvar;}
switch(True){case((i)==0):ChangeForm(frmLifts);break;case((i)==1):ChangeForm(frmLiftClubs);break;case((i)==2):ChangeForm(frmChooser);}
return savethefunction_rvar;}
window.addEventListener('load',function(){frmLogin.style.display='block';NSB.addProperties(hdLogin);NSB.addDisableProperty(hdLogin);hdLogin_left.onclick=function(){ChangeForm(frmMain)};if(typeof(hdLogin.onclick)=='function'){if(typeof(hdLogin_left)!='undefined')hdLogin_left.onclick=function(){hdLogin.onclick(hdLogin_left.getAttribute('nsbvalue'))};if(typeof(hdLogin_right)!='undefined')hdLogin_right.onclick=function(){hdLogin.onclick(hdLogin_right.getAttribute('nsbvalue'))}};NSB.MultiInput_init('txtLogin');NSB.addProperties(txtLogin);ftLogin.refresh=function(){setTimeout(NSB.FooterBarRefresh,10,ftLogin)};NSB.FooterBar_jqm_init('ftLogin','Sign In,Get Password,Get Secret');NSB.addProperties(ftLogin);(function(){var d,i,s=''.split(',');for(i=0;i<s.length;i++){if(trim(s[i])!=''){d=document.getElementById('ftLogin_'+i);(function(i){d.onclick=function(){ChangeForm(document.getElementById(s[i]))}})(i)}}})()
frmLogin.style.display='none';},false);frmLogin.onsubmit=function(event){window.event.stopPropagation();window.event.preventDefault()};NSB.addProperties(frmLogin);function ResizeLogin(){savethefunction_rvar="";txtLogin.Left=0;txtLogin.Top=42;txtLogin.Width=frmLogin.Width-20;return savethefunction_rvar;}
frmLogin.onshow=function(){savethefunction_rvar="";usrProfile=[];usrProfile.first="Guest";user=localStorage.getItem("user");usrLoginAttempts=0;ResizeLogin();txtLogin.setValue(1,user);txtLogin.setValue(2,"");return savethefunction_rvar;}
function UserLogin(){savethefunction_rvar="";user=txtLogin.getValue(1);user=LCase(Trim(user));password=Trim(txtLogin.getValue(2));if(IsBlank(user,"Cellphone #",usrProfile.first)==True){return savethefunction_rvar;}
if(IsBlank(password,"Password",usrProfile.first)==True){return savethefunction_rvar;}
localStorage.setItem("user",user);ReadUser(user);VerifyUser();return savethefunction_rvar;}
function VerifyUser(){savethefunction_rvar="";if(TypeName(usrProfile)=="null"){NSB.MsgBox(AskRegister,"The user profile for the specified Cellphone Number does not exist, would you like to register to I-Need-A-Lift now "+usrProfile.first+"?",4+32,"Profile Error");return savethefunction_rvar;}
var icell,ipwd,iblocked;usrFound=False;icell=usrProfile.mobile;ipwd=usrProfile.password;iblocked=usrProfile.blocked;if(iblocked=="y"){txtLogin.setValue(2,"");NSB.MsgBox(ActivateProfile,"This profile needs to be activated first, would you like to Activate your profile now "+usrProfile.first+"?",4+32,"Profile Error");return;}
if(icell==user){if(ipwd==password){usrFound=True;}}
NSB.WaitCursor(False);usrKey=user+"-LoginAttempts";if(usrFound==False){usrLoginAttempts=localStorage.getItem(usrKey);usrLoginAttempts=_jsCint(usrLoginAttempts)+1;localStorage.setItem(usrKey,usrLoginAttempts);if(usrLoginAttempts>=3){usrProfile.blocked="y";SaveUser();NSB.MsgBox(ActivateProfile,"Due to 3 incorrect login attempts, your profile has been de-activated, do you want to re-activate your profile now "+usrProfile.first+"?",4+32,"Profile Error");}else{NSB.MsgBox("You have entered incorrect Sign In details. Please verify that your Cellphone No and Password are correct "+usrProfile.first+". Please remember the password is CaSE sensitive!");return;}}else{localStorage.setItem(usrKey,"0");usrProfile.lastlogin=FormatDateTime(CDATE(new Date()),"yyyy-mm-dd");SaveUser();ChangeForm(frmAfterLogin);}
return savethefunction_rvar;}
function ActivateProfile(result){if(result==7){return;}
usrFrom="frmLogin";ChangeForm(frmRegCode);}
function AskRegister(result){if(result==7){return;}
usrFrom="frmLogin";ChangeForm(frmSignUp);}
ftLogin.onclick=function(choice){savethefunction_rvar="";if(TypeName(choice)=="object"){return savethefunction_rvar;}
switch(True){case((choice)=="Sign_In"):UserLogin();break;case((choice)=="Get_Password"):user=txtLogin.getValue(1);user=LCase(Trim(user));if(IsBlank(user,"Cellphone #",usrProfile.first)==True){return savethefunction_rvar;}
localStorage.setItem("user",user);ReadUser(user);GetPassword();break;case((choice)=="Get_Secret"):user=txtLogin.getValue(1);user=LCase(Trim(user));if(IsBlank(user,"Cellphone #",usrProfile.first)==True){return savethefunction_rvar;}
localStorage.setItem("user",user);ReadUser(user);GetSecret();}
return savethefunction_rvar;}
function GetPassword(){savethefunction_rvar="";if(TypeName(usrProfile)=="null"){NSB.MsgBox(AskRegister,"The user profile for the specified Cellphone Number does not exist, would you like to register to I-Need-A-Lift now "+usrProfile.first+"?",4+32,"Profile Error");return savethefunction_rvar;}
var icell,iblocked;icell=usrProfile.mobile;iblocked=usrProfile.blocked;if(iblocked=="y"){NSB.MsgBox("This profile needs to be activated first, select Get Secret below!");return;}
NSB.WaitCursor(False);usrSent=SendSMS("27",usrProfile.mobile,"I-Need-A-Lift: Good day "+usrProfile.first+", your Password is "+usrProfile.password+". I-Need-A-Lift Development Team @ http://www.mbangas.com/i-need-a-lift");if(usrSent==True){NSB.MsgBox("The password was succesfully sent to the specified registered cellphone number "+usrProfile.first+"!");}else{NSB.MsgBox("The Password was not succesfully sent to the specified registered cellphone number, please try again "+usrProfile.first+"!");}
return savethefunction_rvar;}
function GetSecret(){savethefunction_rvar="";usrSent=ResendSecretCode();if(usrSent==True){ChangeForm(frmRegCode);}else{NSB.MsgBox("The Secret Code was not succesfully sent to the specified registered cellphone number, please try again "+usrProfile.first+"!");}
return savethefunction_rvar;}