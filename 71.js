window.addEventListener('load',function(){frmMyBookings.style.display='block';NSB.addProperties(hdMyBookings);NSB.addDisableProperty(hdMyBookings);hdMyBookings_left.onclick=function(){ChangeForm(frmChooser)};if(typeof(hdMyBookings.onclick)=='function'){if(typeof(hdMyBookings_left)!='undefined')hdMyBookings_left.onclick=function(){hdMyBookings.onclick(hdMyBookings_left.getAttribute('nsbvalue'))};if(typeof(hdMyBookings_right)!='undefined')hdMyBookings_right.onclick=function(){hdMyBookings.onclick(hdMyBookings_right.getAttribute('nsbvalue'))}};NSB.List_jqm_init14('lstMyBookings','Offers',true,'100%',false,false);lstMyBookings_ref=new IScroll(lstMyBookings_scroller,{mouseWheel:true,scrollbars:true,bounce:true,zoom:false,click:iScrollClick()});lstMyBookings.refresh=function(){if(typeof lstMyBookings_ref!='undefined')setTimeout(NSB.refresh,100,lstMyBookings_ref)};NSB.addProperties(lstMyBookings,lstMyBookings_scroller);(function(){var d,i,s=''.split(',');for(i=0;i<s.length;i++){if(trim(s[i])!=''){d=document.getElementById('lstMyBookings_'+i);(function(i){d.onclick=function(){ChangeForm(document.getElementById(s[i]))}})(i)}}})()
frmMyBookings.style.display='none';},false);frmMyBookings.onsubmit=function(event){window.event.stopPropagation();window.event.preventDefault()};NSB.addProperties(frmMyBookings);function ResizeMyBookings(){savethefunction_rvar="";lstMyBookings.Height=frmMyBookings.Height-42;return savethefunction_rvar;}
function RefreshMyBookings(){savethefunction_rvar="";var i,rCnt,sbooked,ibooked,sFromTo,stable;NSB.WaitCursor(True);ListViewClear(lstMyBookings);bookings=[];req=Ajax("ajaxOffers.php");if(req.status==200){bookingfiles=Split(req.responseText,'\n');for(i=0;i<=bookingfiles.length-1;i++){bookingfile=Trim(bookingfiles[i]);if(Len(bookingfile)>0){req=Ajax("ajaxOffers.php?file="+encodeURIComponent(bookingfile));if(req.status==200){usrBooking=$.xml2json(req.responseText);sbooked=usrBooking.acceptedby;ibooked=MvSearch(sbooked,usrProfile.mobile,";");if(ibooked!=-1){bookings.push(usrBooking);}}}}
bookings=sortJSON(bookings,"date");for(i=0;i<=bookings.length-1;i++){usrBooking=bookings[i];stable=OfferTable(usrBooking);sFromTo=usrBooking.origin+" to "+usrBooking.destination;ListViewAddTitleDescriptionSideContent(lstMyBookings,sFromTo,stable,"","",usrBooking.id,"");}
ListViewRefresh(lstMyBookings);}else{if(req.status==404){req.err="No files found!";}
NSB.MsgBox("Error while retrieving lift offers: "+req.err);}
NSB.WaitCursor(False);return savethefunction_rvar;}
frmMyBookings.onshow=function(){savethefunction_rvar="";ResizeMyBookings();RefreshMyBookings();return savethefunction_rvar;}
lstMyBookings.onclick=function(i){savethefunction_rvar="";if(TypeName(i)=="object"){return savethefunction_rvar;}
bookingfile=i;ChangeForm(frmOpenBooking);return savethefunction_rvar;}
hdMyBookings.onclick=function(choice){savethefunction_rvar="";if(TypeName(choice)=="object"){return savethefunction_rvar;}
switch(True){case((choice)=="Back"):ChangeForm(frmChooser);break;case((choice)=="Refresh"):RefreshMyBookings();}
return savethefunction_rvar;}
window.addEventListener('load',function(){frmMyOffers.style.display='block';NSB.addProperties(hdMyOffers);NSB.addDisableProperty(hdMyOffers);hdMyOffers_left.onclick=function(){ChangeForm(frmChooser)};if(typeof(hdMyOffers.onclick)=='function'){if(typeof(hdMyOffers_left)!='undefined')hdMyOffers_left.onclick=function(){hdMyOffers.onclick(hdMyOffers_left.getAttribute('nsbvalue'))};if(typeof(hdMyOffers_right)!='undefined')hdMyOffers_right.onclick=function(){hdMyOffers.onclick(hdMyOffers_right.getAttribute('nsbvalue'))}};NSB.List_jqm_init14('lstMyOffers','Offers',true,'100%',false,false);lstMyOffers_ref=new IScroll(lstMyOffers_scroller,{mouseWheel:true,scrollbars:true,bounce:true,zoom:false,click:iScrollClick()});lstMyOffers.refresh=function(){if(typeof lstMyOffers_ref!='undefined')setTimeout(NSB.refresh,100,lstMyOffers_ref)};NSB.addProperties(lstMyOffers,lstMyOffers_scroller);(function(){var d,i,s=''.split(',');for(i=0;i<s.length;i++){if(trim(s[i])!=''){d=document.getElementById('lstMyOffers_'+i);(function(i){d.onclick=function(){ChangeForm(document.getElementById(s[i]))}})(i)}}})()
frmMyOffers.style.display='none';},false);frmMyOffers.onsubmit=function(event){window.event.stopPropagation();window.event.preventDefault()};NSB.addProperties(frmMyOffers);function ResizeMyOffers(){savethefunction_rvar="";lstMyOffers.Height=frmMyOffers.Height-42;return savethefunction_rvar;}
function RefreshMyOffers(){savethefunction_rvar="";var i,rCnt,stable,sbooked,ibooked,stable,sFromTo;NSB.WaitCursor(True);ListViewClear(lstMyOffers);offers=[];req=Ajax("ajaxOffers.php");if(req.status==200){offerfiles=Split(req.responseText,'\n');for(i=0;i<=offerfiles.length-1;i++){offerfile=Trim(offerfiles[i]);if(Len(offerfile)>0){req=Ajax("ajaxOffers.php?file="+encodeURIComponent(offerfile));if(req.status==200){usrOffer=$.xml2json(req.responseText);if(usrOffer.offermobile==usrProfile.mobile){offers.push(usrOffer);}}}}
offers=sortJSON(offers,"date");for(i=0;i<=offers.length-1;i++){usrOffer=offers[i];stable=OfferTable(usrOffer);sFromTo=usrOffer.origin+" to "+usrOffer.destination;ListViewAddTitleDescriptionSideContent(lstMyOffers,sFromTo,stable,"","",usrOffer.id,"");}
ListViewRefresh(lstMyOffers);}else{if(req.status==404){req.err="No files found!";}
NSB.MsgBox("Error while retrieving lift offers: "+req.err);}
NSB.WaitCursor(False);return savethefunction_rvar;}
frmMyOffers.onshow=function(){savethefunction_rvar="";ResizeMyOffers();RefreshMyOffers();return savethefunction_rvar;}
lstMyOffers.onclick=function(i){savethefunction_rvar="";if(TypeName(i)=="object"){return savethefunction_rvar;}
bookingfile=i;return savethefunction_rvar;}
hdMyOffers.onclick=function(choice){savethefunction_rvar="";if(TypeName(choice)=="object"){return savethefunction_rvar;}
switch(True){case((choice)=="Back"):ChangeForm(frmChooser);break;case((choice)=="Refresh"):RefreshMyOffers();}
return savethefunction_rvar;}
window.addEventListener('load',function(){frmOpenBooking.style.display='block';NSB.addProperties(hdOpenBooking);NSB.addDisableProperty(hdOpenBooking);hdOpenBooking_left.onclick=function(){ChangeForm(frmMyBookings)};if(typeof(hdOpenBooking.onclick)=='function'){if(typeof(hdOpenBooking_left)!='undefined')hdOpenBooking_left.onclick=function(){hdOpenBooking.onclick(hdOpenBooking_left.getAttribute('nsbvalue'))};if(typeof(hdOpenBooking_right)!='undefined')hdOpenBooking_right.onclick=function(){hdOpenBooking.onclick(hdOpenBooking_right.getAttribute('nsbvalue'))}};NSB.List_jqm_init14('lstOpenBooking','Offer',false,'100%',false,false);lstOpenBooking.refresh=function(){if(typeof lstOpenBooking_ref!='undefined')setTimeout(NSB.refresh,100,lstOpenBooking_ref)};NSB.addProperties(lstOpenBooking);(function(){var d,i,s=''.split(',');for(i=0;i<s.length;i++){if(trim(s[i])!=''){d=document.getElementById('lstOpenBooking_'+i);(function(i){d.onclick=function(){ChangeForm(document.getElementById(s[i]))}})(i)}}})()
fbOpenBooking.refresh=function(){setTimeout(NSB.FooterBarRefresh,10,fbOpenBooking)};NSB.FooterBar_jqm_init('fbOpenBooking','Call,SMS,Cancel');NSB.addProperties(fbOpenBooking);(function(){var d,i,s=''.split(',');for(i=0;i<s.length;i++){if(trim(s[i])!=''){d=document.getElementById('fbOpenBooking_'+i);(function(i){d.onclick=function(){ChangeForm(document.getElementById(s[i]))}})(i)}}})()
frmOpenBooking.style.display='none';},false);frmOpenBooking.onsubmit=function(event){window.event.stopPropagation();window.event.preventDefault()};NSB.addProperties(frmOpenBooking);fbOpenBooking.onclick=function(choice){savethefunction_rvar="";if(TypeName(choice)=="object"){return savethefunction_rvar;}
switch(True){case((choice)=="Call"):phone(usrBooking.offermobile);break;case((choice)=="SMS"):sms(usrBooking.offermobile,"");break;case((choice)=="Cancel"):NSB.MsgBox(ConfirmBookingCancellation,"Are you sure that you want to Cancel this booking "+usrProfile.first+"?",4+32,"Cancel Booking");}
return savethefunction_rvar;}
function ConfirmBookingCancellation(result){if(result==7){return;}
ReadOffer(usrBooking.id);var stracceptedby;if(TypeName(usrOffer)=="null"){NSB.MsgBox("This lift offer does no longer exist and your booking has been automatically cancelled "+usrProfile.first+"!");return;}
if(usrOffer.status=="Completed"){NSB.MsgBox("This lift offer has already been completed now and your booking cannot be cancelled "+usrProfile.first+"!");return;}
usrOffer.acceptedby=MvRemoveItem(usrOffer.acceptedby,usrProfile.mobile,";");usrOffer.taken=MvCount(usrOffer.acceptedby,";");if(usrOffer.passengers==usrOffer.taken){usrOffer.status="Closed";}else{usrOffer.status="Open";}
SaveLiftOffer(usrOffer);oSaved=OfferExists(usrOffer.id);if(oSaved==True){NSB.MsgBox(ShowMyBookings,"Your booking cancellation has been successfully saved "+usrProfile.first+"!");}else{NSB.MsgBox("Your booking cancellation has not been successfully saved, please try again "+usrProfile.first+"!");}
return savethefunction_rvar;}
function ShowMyBookings(result){ChangeForm(frmMyBookings);}
frmOpenBooking.onshow=function(){savethefunction_rvar="";var sFromTo,stable;lstOpenBooking.Left=0;lstOpenBooking.Top=42;lstOpenBooking.Height=frmOpenBooking.Height-42;lstOpenBooking.Width=frmOpenBooking.Width;ListViewClear(lstOpenBooking);ReadOffer(bookingfile);if(TypeName(usrOffer)=="null"){NSB.MsgBox("This lift offer could not be read, please try again "+usrProfile.first+"!");return savethefunction_rvar;}
stable=OfferTable(usrOffer);sFromTo=usrOffer.origin+" to "+usrOffer.destination;ListViewAddTitleDescriptionSideContent(lstOpenBooking,sFromTo,stable,"","",usrOffer.id,"");return savethefunction_rvar;}
window.addEventListener('load',function(){frmMyRequests.style.display='block';NSB.addProperties(hdMyRequests);NSB.addDisableProperty(hdMyRequests);hdMyRequests_left.onclick=function(){ChangeForm(frmChooser)};if(typeof(hdMyRequests.onclick)=='function'){if(typeof(hdMyRequests_left)!='undefined')hdMyRequests_left.onclick=function(){hdMyRequests.onclick(hdMyRequests_left.getAttribute('nsbvalue'))};if(typeof(hdMyRequests_right)!='undefined')hdMyRequests_right.onclick=function(){hdMyRequests.onclick(hdMyRequests_right.getAttribute('nsbvalue'))}};NSB.List_jqm_init14('lstMyRequests','Offers',true,'100%',false,false);lstMyRequests_ref=new IScroll(lstMyRequests_scroller,{mouseWheel:true,scrollbars:true,bounce:true,zoom:false,click:iScrollClick()});lstMyRequests.refresh=function(){if(typeof lstMyRequests_ref!='undefined')setTimeout(NSB.refresh,100,lstMyRequests_ref)};NSB.addProperties(lstMyRequests,lstMyRequests_scroller);(function(){var d,i,s=''.split(',');for(i=0;i<s.length;i++){if(trim(s[i])!=''){d=document.getElementById('lstMyRequests_'+i);(function(i){d.onclick=function(){ChangeForm(document.getElementById(s[i]))}})(i)}}})()
frmMyRequests.style.display='none';},false);frmMyRequests.onsubmit=function(event){window.event.stopPropagation();window.event.preventDefault()};NSB.addProperties(frmMyRequests);function ResizeMyRequests(){savethefunction_rvar="";lstMyRequests.Height=frmMyRequests.Height-42;return savethefunction_rvar;}
function RefreshMyRequests(){savethefunction_rvar="";var i,rCnt,sFromTo,stable,soffermobile;NSB.WaitCursor(True);ListViewClear(lstMyRequests);requests=[];req=Ajax("ajaxRequests.php");if(req.status==200){requestfiles=Split(req.responseText,'\n');for(i=0;i<=requestfiles.length-1;i++){requestfile=Trim(requestfiles[i]);if(Len(requestfile)>0){req=Ajax("ajaxRequests.php?file="+encodeURIComponent(requestfile));if(req.status==200){usrRequest=$.xml2json(req.responseText);soffermobile=usrRequest.offermobile;if(soffermobile==usrProfile.mobile){requests.push(usrRequest);}}}}
requests=sortJSON(requests,"date");for(i=0;i<=requests.length-1;i++){usrRequest=requests[i];sFromTo=usrRequest.origin+" to "+usrRequest.destination;stable=RequestTable(usrRequest);ListViewAddTitleDescriptionSideContent(lstMyRequests,sFromTo,stable,"","",usrRequest.id,"");}
ListViewRefresh(lstMyRequests);}else{if(req.status==404){req.err="No files found!";}
NSB.MsgBox("Error while retrieving lift offers: "+req.err);}
NSB.WaitCursor(False);return savethefunction_rvar;}
frmMyRequests.onshow=function(){savethefunction_rvar="";ResizeMyRequests();RefreshMyRequests();return savethefunction_rvar;}
lstMyRequests.onclick=function(i){savethefunction_rvar="";if(TypeName(i)=="object"){return savethefunction_rvar;}
requestfile=i;return savethefunction_rvar;}
hdMyRequests.onclick=function(choice){savethefunction_rvar="";if(TypeName(choice)=="object"){return savethefunction_rvar;}
switch(True){case((choice)=="Back"):ChangeForm(frmChooser);break;case((choice)=="Refresh"):RefreshMyRequests();}
return savethefunction_rvar;}
window.addEventListener('orientationchange',function(){window.scrollTo(0,0)});window.addEventListener('load',function(){browserWarningMessage('Please use Google Chrome, Apple Safari or another supported browser.');frmMain.style.display='block';Main();if(typeof(frmMain.onshow)=='function')frmMain.onshow();},false);var NSBCurrentForm=frmMain;